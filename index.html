<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather Vibe Player</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
    --bg1:#2c2a35;
    --bg2:#1a181f;
    --card-bg:rgba(255,255,255,0.08);
    --accent:#4a90e2;
}

*{margin:0;padding:0;box-sizing:border-box;}

body{
    font-family:'Poppins',sans-serif;
    background:linear-gradient(to bottom,var(--bg1),var(--bg2));
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    color:white;
    transition:background 0.8s ease;
}

.phone-container{
    width:375px;
    height:812px;
    border-radius:40px;
    overflow:hidden;
    box-shadow:0 20px 40px rgba(0,0,0,0.6);
}

.content{
    padding:30px 20px;
    display:flex;
    flex-direction:column;
    height:100%;
}

.search-box{
    display:flex;
    background:var(--card-bg);
    border-radius:20px;
    padding:12px 20px;
    margin-bottom:20px;
}

.search-box input{
    flex:1;
    background:none;
    border:none;
    color:white;
    outline:none;
    font-size:16px;
}

.search-box button{
    background:none;
    border:none;
    color:#aaa;
    cursor:pointer;
}

.loading{display:none;color:var(--accent);margin-bottom:10px;}
.error{display:none;color:#ff6b6b;margin-bottom:10px;text-align:center;}

.weather-display,
.weather-details{
    opacity:0;
    transform:translateY(10px);
    transition:0.4s ease;
}

.weather-display.show,
.weather-details.show{
    opacity:1;
    transform:translateY(0);
}

.weather-display{text-align:center;margin-bottom:20px;}
.weather-icon{font-size:80px;margin-bottom:15px;}
.temp{font-size:72px;font-weight:600;}

.weather-details{
    display:flex;
    justify-content:space-around;
    background:var(--card-bg);
    border-radius:20px;
    padding:15px;
    margin-bottom:25px;
}

.music-card{
    margin-top:auto;
    background:rgba(255,255,255,0.1);
    border-radius:30px;
    padding:25px;
    text-align:center;
}

#artist-name{color:#ccc;font-size:14px;margin-bottom:15px;}

audio{width:100%;filter:invert(1);margin-bottom:15px;}

.btn-generate{
    background:var(--accent);
    border:none;
    padding:15px;
    border-radius:20px;
    width:100%;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
}

.btn-generate:hover{transform:scale(1.05);}
</style>
</head>

<body>

<div class="phone-container">
<div class="content">

<div class="search-box">
<input id="city-input" placeholder="Search City...">
<button id="search-btn"><i class="fas fa-search"></i></button>
</div>

<div id="loading" class="loading">Searching...</div>
<div id="error" class="error"></div>

<div class="weather-display" id="weather-ui">
<span id="ui-city"></span>
<i id="ui-icon" class="fas fa-sun weather-icon"></i>
<div class="temp"><span id="ui-temp"></span>Â°C</div>
<p id="ui-desc"></p>
</div>

<div class="weather-details" id="details-ui">
<div><i class="fas fa-wind"></i> <span id="ui-wind"></span></div>
<div><i class="fas fa-tint"></i> <span id="ui-hum"></span></div>
<div>UV <span id="ui-uv"></span></div>
</div>

<div class="music-card">
<div id="track-name">Find a city</div>
<div id="artist-name">to match the vibe</div>
<audio id="player" controls></audio>
<button class="btn-generate" id="refresh-music">New Song</button>
</div>

</div>
</div>

<script>
const W_KEY="6ebe7ba0e7944032a8331954261402";
const DISCOVERY="https://discoveryprovider.audius.co";

const player=document.getElementById("player");
let playlist=[];
let index=0;

async function initSearch(){
const city=document.getElementById("city-input").value.trim();
if(!city) return;

showLoading(true);
showError("");

try{
const response=await fetch(
`https://api.weatherapi.com/v1/current.json?key=${W_KEY}&q=${encodeURIComponent(city)}&aqi=no`
);

if(!response.ok){
const errorData=await response.json();
throw new Error(errorData.error?.message || "City not found");
}

const data=await response.json();
updateWeatherUI(data);

const mood=getMood(data.current.condition.code);
await fetchMusic(mood);

}catch(err){
console.error(err);
showError(err.message);
}

showLoading(false);
}

async function fetchMusic(mood){
try{
const res=await fetch(`${DISCOVERY}/v1/tracks/search?query=${encodeURIComponent(mood)}&limit=20`);
const data=await res.json();

if(!data.data || data.data.length===0){
throw new Error("No tracks found");
}

playlist=data.data;
index=0;
playTrack();

}catch{
showError("Music service unavailable");
}
}

function playTrack(){
if(!playlist.length) return;
const track=playlist[index % playlist.length];

document.getElementById("track-name").textContent=track.title;
document.getElementById("artist-name").textContent=track.user.name;

player.src=`${DISCOVERY}/v1/tracks/${track.id}/stream`;
player.play().catch(()=>{});

index++;
}

player.addEventListener("ended",playTrack);

function updateWeatherUI(d){
document.getElementById("ui-city").textContent=d.location.name;
document.getElementById("ui-temp").textContent=Math.round(d.current.temp_c);
document.getElementById("ui-desc").textContent=d.current.condition.text;
document.getElementById("ui-wind").textContent=d.current.wind_kph+" kph";
document.getElementById("ui-hum").textContent=d.current.humidity+"%";
document.getElementById("ui-uv").textContent=d.current.uv;

document.getElementById("weather-ui").classList.add("show");
document.getElementById("details-ui").classList.add("show");
}

function getMood(code){
if(code===1000) return "happy pop";
if(code<=1009) return "chill ambient";
if(code>=1063) return "lofi rain";
return "relaxing";
}

function showLoading(s){
document.getElementById("loading").style.display=s?"block":"none";
}

function showError(m){
const e=document.getElementById("error");
if(!m){e.style.display="none";return;}
e.textContent=m;
e.style.display="block";
}

document.getElementById("search-btn").onclick=initSearch;
document.getElementById("refresh-music").onclick=playTrack;
document.getElementById("city-input").addEventListener("keypress",e=>{
if(e.key==="Enter") initSearch();
});
</script>

</body>
</html>